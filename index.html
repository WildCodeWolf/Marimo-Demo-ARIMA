<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <marimo-mode data-mode='read' hidden></marimo-mode>
    <marimo-version data-version='0.13.15' hidden></marimo-version>
    <marimo-user-config data-config='{"completion": {"activate_on_typing": true, "copilot": false}, "display": {"dataframes": "rich", "code_editor_font_size": 14, "cell_output": "above", "default_table_page_size": 10, "theme": "system", "default_width": "full"}, "formatting": {"line_length": 79}, "keymap": {"preset": "default", "overrides": {}}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "reactive_tests": true, "on_cell_change": "autorun", "watcher_on_save": "lazy", "output_max_bytes": 8000000, "std_stream_max_bytes": 1000000, "default_sql_output": "auto"}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "package_management": {"manager": "uv"}, "server": {"browser": "default", "follow_symlink": false}, "language_servers": {"pylsp": {"enabled": true, "enable_mypy": true, "enable_ruff": true, "enable_flake8": false, "enable_pydocstyle": false, "enable_pylint": false, "enable_pyflakes": false}}, "snippets": {"custom_paths": [], "include_default_snippets": true}}' data-overrides='{}' hidden></marimo-user-config>
    <marimo-app-config data-config='{"width": "full", "app_title": "Arctic Neural | Demo: Stock Price Predition", "sql_output": "auto"}' hidden></marimo-app-config>
    <marimo-server-token data-token='123' hidden></marimo-server-token>
    <title>Arctic Neural | Demo: Stock Price Predition</title>
    <script type="module" crossorigin src="./assets/index-aRpq2G87.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-BqXWXM9d.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    
    <style>
        #save-button {
            display: none !important;
        }
        #filename-input {
            display: none !important;
        }
    </style>
    <marimo-code hidden="" data-show-code="false">import%20marimo%0A%0A__generated_with%20%3D%20%220.13.15%22%0Aapp%20%3D%20marimo.App(%0A%20%20%20%20width%3D%22full%22%2C%0A%20%20%20%20app_title%3D%22Arctic%20Neural%20%7C%20Demo%3A%20Stock%20Price%20Predition%22%2C%0A)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20Import%20marimo%20first%20and%20quick%0A%20%20%20%20import%20marimo%20as%20mo%0A%0A%20%20%20%20%23%20Prepare%20a%20state%20to%20track%20if%20there's%20something%20to%20be%20displayed%3B%0A%20%20%20%20%23%20used%20to%20show%20the%20visitor%20that%20the%20website%20is%20working%0A%20%20%20%20is_data_loaded%2C%20data_is_loaded%20%3D%20mo.state(False)%0A%20%20%20%20return%20data_is_loaded%2C%20is_data_loaded%2C%20mo%0A%0A%0A%40app.cell%0Adef%20_(is_data_loaded%2C%20mo)%3A%0A%20%20%20%20%23%20Experimental%3A%20Show%20*something*%20unless%20there's%20actually%20something%20to%20show%0A%20%20%20%20mo.stop(is_data_loaded())%0A%0A%20%20%20%20mo.md(%22Data%20is%20currently%20being%20loaded.%20%20This%20will%20take%20just%20a%20few%20seconds...%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20Import%20remaining%20libararies%0A%20%20%20%20import%20pandas%20as%20pd%0A%20%20%20%20import%20altair%20as%20alt%0A%20%20%20%20import%20pyarrow%20%20%23%20for%20altair%20charts%0A%0A%20%20%20%20%23%20Import%20specific%20functions%2F%20classes%0A%20%20%20%20from%20sklearn.datasets%20import%20fetch_openml%0A%20%20%20%20from%20statsmodels.tsa.arima.model%20import%20ARIMA%0A%0A%20%20%20%20%23%20Suppress%20warnings%0A%20%20%20%20import%20warnings%0A%0A%20%20%20%20warnings.filterwarnings(%22ignore%22%2C%20category%3DUserWarning)%0A%20%20%20%20return%20ARIMA%2C%20alt%2C%20fetch_openml%2C%20pd%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20data%2C%0A%20%20%20%20df%2C%0A%20%20%20%20display_dataset_details%2C%0A%20%20%20%20display_historical_background%2C%0A%20%20%20%20full_detail_markdown%2C%0A%20%20%20%20historical_context%2C%0A%20%20%20%20mo%2C%0A)%3A%0A%20%20%20%20mo.vstack(%0A%20%20%20%20%20%20%20%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22%22%22%0A%20%20%20%20%23%20Arctic%20Neural%3A%20Stock%20Price%20Prediction%20Demo%0A%0A%20%20%20%20This%20little%20demo%20uses%20historic%20GameStop%20stock%20price%20records%20and%20trains%20an%0A%20%20%20%20ARIMA%20model%20to%20predict%20future%20prices%20for%20a%20given%20range%20of%20days.%20%20The%20data%0A%20%20%20%20itself%20is%20hosted%20on%20%7Bdata.url%7D%20and%20is%20primarily%20intended%20to%20be%20used%20for%0A%20%20%20%20detecting%20abnormal%20stock%20price%20trends.%0A%0A%20%20%20%20The%20time%20range%20covered%20by%20the%20dataset%20(up%20to%20%7Bdf.date.max().date()%7D)%0A%20%20%20%20consists%20of%20a%20long%20relatively%20consistent%20period%20and%20terminates%20in%20a%20steep%0A%20%20%20%20increase%20in%20prices%2C%20which%20led%20to%20a%20historic%20catastrophe%20and%20the%20subsequent%0A%20%20%20%20introduction%20of%20new%2C%20strict%20regulations.%0A%0A%20%20%20%20While%20creating%20a%20detection%20mechanism%20for%20those%20abnormal%20surges%20itself%20is%0A%20%20%20%20already%20an%20interesting%20task%2C%20this%20demo%20here%20focuses%20on%20the%20objective%20of%0A%20%20%20%20predicting%20trends%20in%20the%20future.%20%20The%20choice%20of%20a%20dataset%20that%20ends%20with%20an%0A%20%20%20%20irregularity%20is%20intentional%3B%20it%20allows%20for%20some%20interesting%20discussions%20and%0A%20%20%20%20experiments%20with%20the%20model%20parameters.%0A%0A%20%20%20%20If%20you%20want%20to%20learn%20more%20about%20the%20original%20dataset%20itself%2C%20toggle%20the%0A%20%20%20%20switch%20below.%0A%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20display_dataset_details%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20%3Cbr%2F%3E%0A%20%20%20%20%23%23%20Dataset%20Details%3A%20%20Background%2C%20origin%2C%20author%20notes%0A%0A%20%20%20%20%23%23%23%20Description%0A%0A%20%20%20%20%7Bdata.DESCR%7D%0A%0A%20%20%20%20%23%23%23%20Details%0A%0A%20%20%20%20%7Bfull_detail_markdown%7D%0A%0A%20%20%20%20%3Cbr%2F%3E%0A%20%20%20%20%22%22%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20display_dataset_details.value%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20mo.md(%22%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20display_historical_background%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20historical_context%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20display_historical_background.value%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20mo.md(%22%22)%2C%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20Create%20a%20toggle%20to%20display%2F%20hide%20details%20about%20the%20dataset%0A%20%20%20%20display_dataset_details%20%3D%20mo.ui.switch(label%3D%22Show%20dataset%20details%22)%0A%0A%20%20%20%20%23%20Create%20a%20toggle%20to%20display%20the%20historical%20background%20to%20the%20data.%0A%20%20%20%20display_historical_background%20%3D%20mo.ui.switch(label%3D%22Show%20historical%20context%22)%0A%20%20%20%20return%20display_dataset_details%2C%20display_historical_background%0A%0A%0A%40app.cell%0Adef%20_(data)%3A%0A%20%20%20%20%23%20If%20details%20are%20requested%2C%20display%20them%20in%20a%20table%3B%0A%20%20%20%20%23%20This%20string%20is%20the%20markdown%20code%20for%20the%20table%0A%20%20%20%20full_detail_markdown%20%3D%20%22%7C%20Field%20%7C%20Entry%20%7C%5Cn%7C%20---%3A%7C%3A---%20%7C%5Cn%22%20%2B%20%22%22.join(%0A%20%20%20%20%20%20%20%20%5Bf%22%7C%20%7Bkey%7D%20%7C%20%7Bvalue%7D%20%7C%5Cn%22%20for%20key%2C%20value%20in%20data.details.items()%5D%2C%0A%20%20%20%20)%0A%20%20%20%20return%20(full_detail_markdown%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20Historical%20context%2C%20AI-generated%0A%20%20%20%20historical_context%20%3D%20mo.md(%0A%20%20%20%20%20%20%20%20f%22%22%22%3Cbr%2F%3E%0A%20%20%20%20%23%23%20Historical%20Context%3A%20The%20GameStop%20Short%20Squeeze%0A%0A%20%20%20%20Disclaimer%3A%20%20This%20passage%20has%20been%20compiled%20using%20ChatGPT%2C%20with%20minor%0A%20%20%20%20modifications.%0A%0A%20%20%20%20%23%23%23%20**Timeline**%0A%0A%20%20%20%20*%20The%20**short%20squeeze**%20began%20gaining%20momentum%20**in%20early%20January%202021**%2C%0A%20%20%20%20%20%20peaking%20around%20**January%2028%2C%202021**.%0A%20%20%20%20*%20GameStop's%20stock%20surged%20from%20under%20**%5C%5C%2420%20in%20early%20January%202021**%20to%20an%0A%20%20%20%20%20%20intraday%20high%20of%20**%5C%5C%24483%20on%20January%2028%2C%202021**.%0A%0A%20%20%20%20%23%23%23%20**Underlying%20Dynamics**%0A%0A%20%20%20%20The%20event%20was%20driven%20by%20a%20mix%20of%3A%0A%0A%20%20%20%20*%20**High%20short%20interest**%3A%20Over%20100%25%20of%20GameStop%E2%80%99s%20float%20was%20shorted%20by%0A%20%20%20%20%20%20institutional%20investors%20(e.g.%2C%20hedge%20funds%20like%20Melvin%20Capital)%2C%20a%20rare%0A%20%20%20%20%20%20and%20risky%20situation.%0A%20%20%20%20*%20**Retail%20coordination**%3A%20Retail%20traders%2C%20particularly%20users%20of%20the%0A%20%20%20%20%20%20**r%2FWallStreetBets%20subreddit**%2C%20began%20buying%20shares%20and%20options%20en%20masse%0A%20%20%20%20%20%20to%20trigger%20a%20**short%20squeeze**.%0A%20%20%20%20*%20**Gamma%20squeeze%20mechanics**%3A%20Options%20trading%20contributed%20to%20upward%20price%0A%20%20%20%20%20%20pressure%20as%20market%20makers%20hedged%20against%20call%20option%20exposure%20by%20buying%0A%20%20%20%20%20%20more%20shares.%0A%20%20%20%20*%20**Zero-commission%20trading%20apps**%3A%20Platforms%20like%20**Robinhood**%20enabled%0A%20%20%20%20%20%20mass%20retail%20participation.%0A%0A%20%20%20%20%23%23%23%20**Significance**%0A%0A%20%20%20%20*%20**Market%20mechanics**%20were%20scrutinized%2C%20including%20the%20role%20of%20payment%20for%0A%20%20%20%20%20%20order%20flow%2C%20clearinghouse%20requirements%2C%20and%20the%20dynamics%20of%20retail%0A%20%20%20%20%20%20brokerage%20risk%20management.%0A%20%20%20%20*%20**Trading%20restrictions**%20were%20imposed%20by%20platforms%20like%20Robinhood%2C%0A%20%20%20%20%20%20triggering%20political%20and%20regulatory%20scrutiny.%0A%20%20%20%20*%20**Broader%20impacts**%20included%20hearings%20by%20the%20U.S.%20Congress%20and%20debates%0A%20%20%20%20%20%20over%20market%20fairness%20and%20retail%20investor%20protections.%0A%0A%20%20%20%20%23%23%23%20**Aftermath**%0A%0A%20%20%20%20*%20Hedge%20funds%20with%20large%20short%20positions%20reported%20massive%20losses%20(Melvin%0A%20%20%20%20%20%20Capital%20lost%20over%2050%25%20of%20its%20assets%20in%20January%202021%20and%20eventually%20shut%0A%20%20%20%20%20%20down%20in%202022).%0A%20%20%20%20*%20GameStop%E2%80%99s%20volatility%20persisted%20throughout%202021%20with%20continued%20meme%20stock%0A%20%20%20%20%20%20rallies.%0A%20%20%20%20*%20Regulatory%20bodies%20such%20as%20the%20**SEC**%20published%20reports%20analyzing%20the%0A%20%20%20%20%20%20market%20behavior%20(e.g.%2C%20%5BSEC%20Staff%20Report%3A%20%22Equity%20and%20Options%20Market%20Structure%20Conditions%20in%20Early%202021%22%5D(https%3A%2F%2Fwww.sec.gov%2Ffiles%2Fstaff-report-equity-options-market-struction-conditions-early-2021.pdf)).%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%20(historical_context%2C)%0A%0A%0A%40app.cell%0Adef%20_(is_data_loaded%2C%20mo)%3A%0A%20%20%20%20mo.stop(not%20is_data_loaded())%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20Below%20is%20a%20data%20data%20explorer%20for%20you%20to%20check%20out%20the%20data.%20%20It%20is%20not%0A%20%20%20%20meant%20to%20be%20an%20integral%20part%20of%20the%20demo%20itself%2C%20but%20you%20can%20use%20it%20to%0A%20%20%20%20familiarise%20yourself%20with%20the%20data%20a%20bit%20before%20moving%20on.%20%20Feel%20free%20to%0A%20%20%20%20play%20with%20the%20controls%20and%20the%20charts%20themselves.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(data_is_loaded%2C%20fetch_openml%2C%20mo%2C%20pd)%3A%0A%20%20%20%20%23%20Load%20data%0A%20%20%20%20data%20%3D%20fetch_openml(data_id%3D43424%2C%20as_frame%3DTrue)%0A%20%20%20%20df%20%3D%20data.data.copy()%0A%0A%20%20%20%20%23%20Convert%20date%20column%20to%20actual%20datetime%0A%20%20%20%20df.date%20%3D%20pd.to_datetime(df.date)%0A%0A%20%20%20%20%23%20Use%20date%20as%20index%0A%20%20%20%20df.set_index(%22date%22%2C%20inplace%3DTrue%2C%20drop%3DFalse)%0A%0A%20%20%20%20%23%20Prettify%20column%20names%0A%20%20%20%20pretty%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%22date%22%3A%20%22Date%22%2C%0A%20%20%20%20%20%20%20%20%22open_price%22%3A%20%22Opening%20Price%20(USD)%22%2C%0A%20%20%20%20%20%20%20%20%22low_price%22%3A%20%22Low%20Price%20(USD)%22%2C%0A%20%20%20%20%20%20%20%20%22high_price%22%3A%20%22High%20Price%20(USD)%22%2C%0A%20%20%20%20%20%20%20%20%22close_price%22%3A%20%22Closing%20Price%20(USD)%22%2C%0A%20%20%20%20%20%20%20%20%22volume%22%3A%20%22Volume%20(USD)%22%2C%0A%20%20%20%20%20%20%20%20%22adjclose_price%22%3A%20%22Adjusted%20Closing%20Price%20(USD)%22%2C%0A%20%20%20%20%7D%0A%0A%20%20%20%20%23%20Notify%20that%20data%20has%20been%20loaded%0A%20%20%20%20data_is_loaded(True)%0A%0A%20%20%20%20%23%20Display%20a%20data%20explorer%0A%20%20%20%20mo.vstack(%0A%20%20%20%20%20%20%20%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.ui.data_explorer(df)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.ui.table(df.drop(%22date%22%2C%20axis%3D1)%2C%20selection%3DNone)%2C%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20)%0A%20%20%20%20return%20data%2C%20df%2C%20pretty%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20Restrict%20to%20default%20theme%20for%20web%20export%0A%20%20%20%20_restricted%20%3D%20True%0A%0A%20%20%20%20%23%20Choose%20and%20set%20the%20global%20theme%20for%20Altair%20charts%0A%20%20%20%20theme%20%3D%20mo.ui.dropdown(%0A%20%20%20%20%20%20%20%20label%3D%22Theme%22%2C%0A%20%20%20%20%20%20%20%20options%3D%5B%22default%22%5D%0A%20%20%20%20%20%20%20%20if%20_restricted%0A%20%20%20%20%20%20%20%20else%20%5B%22fivethirtyeight%22%2C%20%22ggplot2%22%2C%20%22powerbi%22%2C%20%22excel%22%2C%20%22googlecharts%22%5D%2C%0A%20%20%20%20%20%20%20%20value%3D%22default%22%20if%20_restricted%20else%20%22fivethirtyeight%22%2C%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Give%20some%20visuals%0A%20%20%20%20mo.md(%22%22)%20if%20_restricted%20else%20mo.md(%0A%20%20%20%20%20%20%20%20f%22%7Btheme%7D%5CtSelect%20a%20theme%20for%20the%20visualisations%20below.%22%0A%20%20%20%20)%0A%20%20%20%20return%20(theme%2C)%0A%0A%0A%40app.cell%0Adef%20_(is_data_loaded%2C%20mo)%3A%0A%20%20%20%20mo.stop(not%20is_data_loaded())%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20Next%2C%20let's%20look%20at%20the%20prices%20over%20time.%20%20It's%20a%20good%20start%20to%20see%20what%0A%20%20%20%20we're%20dealing%20with.%20%20The%20following%20graphic%20illustrates%20the%20four%20core%20price%0A%20%20%20%20columns%20in%20one%20graphic%2C%20with%20three%20hand-picked%20windows%20in%20which%20interesting%0A%20%20%20%20fluctuations%20occur.%20%20For%20the%20irregularity%20detection%20task%2C%20the%20first%20two%0A%20%20%20%20could%20be%20used%20as%20edge%20cases%20for%20tolerable%20fluctuations%20for%20an%20ML%20model%20to%0A%20%20%20%20learn%2C%20whereas%20the%20last%20one%20would%20be%20where%20an%20alarm%20would%20go%20off.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(alt%2C%20df%2C%20mo%2C%20pd%2C%20pretty%2C%20theme)%3A%0A%20%20%20%20%23%20To%20plot%20the%20data%20in%20one%20chart%2C%20we%20need%20it%20in%20long%20format%0A%20%20%20%20_df%20%3D%20df.melt(%0A%20%20%20%20%20%20%20%20id_vars%3D%5B%22date%22%2C%20%22volume%22%5D%2C%0A%20%20%20%20%20%20%20%20value_vars%3Dlist(pretty.keys())%5B1%3A5%5D%2C%0A%20%20%20%20%20%20%20%20var_name%3D%22Category%22%2C%0A%20%20%20%20%20%20%20%20value_name%3D%22Price%22%2C%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Prettify%20categories%0A%20%20%20%20_df.Category%20%3D%20_df.Category.map(lambda%20word%3A%20pretty%5Bword%5D)%0A%0A%20%20%20%20%23%20If%20we%20happen%20to%20fall%20back%20to%20the%20default%20theme...%0A%20%20%20%20_is_default_theme_enforced%20%3D%20theme.value%20%3D%3D%20%22default%22%0A%0A%20%20%20%20%23%20Register%20selected%20theme%0A%20%20%20%20if%20not%20_is_default_theme_enforced%3A%0A%20%20%20%20%20%20%20%20alt.theme.enable(theme.value)%0A%0A%20%20%20%20%23%20Visual%20dimensions%0A%20%20%20%20_width%20%3D%20220%20if%20not%20_is_default_theme_enforced%20else%20130%0A%20%20%20%20_height%20%3D%20200%0A%0A%0A%20%20%20%20%23%20Build%20individual%20charts.%20%20Usually%2C%20a%20%60.transform_filter()%60%20would%0A%20%20%20%20%23%20do%20the%20trick%2C%20but%20for%20static%20HTML%20export%20this%20doesn't%20work.%0A%20%20%20%20def%20_make_chart(data%2C%20title%3DNone%2C%20width%3D_width%2C%20height%3D_height)%3A%0A%20%20%20%20%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20alt.Chart(data)%0A%20%20%20%20%20%20%20%20%20%20%20%20.mark_line()%0A%20%20%20%20%20%20%20%20%20%20%20%20.encode(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3Dalt.X(%22date%3AT%22).title(%22Date%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3Dalt.Y(%22Price%3AQ%22).title(%22Price%20(USD)%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3D%22Category%3AN%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20.properties(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20width%3Dwidth%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20height%3Dheight%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20)%0A%0A%0A%20%20%20%20%23%20Interesting%20date%20limits%0A%20%20%20%20_dates%20%3D%20%5B%0A%20%20%20%20%20%20%20%20pd.to_datetime(d)%0A%20%20%20%20%20%20%20%20for%20d%20in%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%222007-01-01%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%222010-12-31%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%222013-01-01%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%222017-12-31%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%222020-11-01%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20_df.date.max().strftime(%22%25Y-%25m-%25d%22)%2C%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20%5D%0A%0A%20%20%20%20%23%20The%20chart%20across%20the%20whole%20time%20line%0A%20%20%20%20_full_chart%20%3D%20_make_chart(%0A%20%20%20%20%20%20%20%20_df%2C%0A%20%20%20%20%20%20%20%20title%3Df%22GameStop%20Stock%20Prices%20from%20%7B_df.date.min().year%7D%20to%20%7B_df.date.max().year%7D%22%2C%0A%20%20%20%20%20%20%20%20width%3D(3.60%20if%20not%20_is_default_theme_enforced%20else%206.00)%20*%20_width%2C%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Auxiliary%20data%20frame%20for%20creating%20highlight%20overlays%0A%20%20%20%20_hightlight_data%20%3D%20pd.DataFrame(%0A%20%20%20%20%20%20%20%20%7Bf%22date%7Bn%7D%22%3A%20_dates%5Bn%5D%20for%20n%20in%20range(6)%7D%2C%20index%3Drange(6)%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20The%20three%20overlays%0A%20%20%20%20_highlight0%20%3D%20(%0A%20%20%20%20%20%20%20%20alt.Chart(_hightlight_data)%0A%20%20%20%20%20%20%20%20.mark_rect(opacity%3D0.025)%0A%20%20%20%20%20%20%20%20.encode(%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3D%22date0%3AT%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x2%3D%22date1%3AT%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20color%3Dalt.ColorValue(%22white%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20_is_default_theme_enforced%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20alt.ColorValue(%22black%22)%2C%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20)%0A%20%20%20%20_highlight1%20%3D%20(%0A%20%20%20%20%20%20%20%20alt.Chart(_hightlight_data)%0A%20%20%20%20%20%20%20%20.mark_rect(opacity%3D0.025)%0A%20%20%20%20%20%20%20%20.encode(%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3D%22date2%3AT%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x2%3D%22date3%3AT%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20color%3Dalt.ColorValue(%22white%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20_is_default_theme_enforced%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20alt.ColorValue(%22black%22)%2C%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20)%0A%20%20%20%20_highlight2%20%3D%20(%0A%20%20%20%20%20%20%20%20alt.Chart(_hightlight_data)%0A%20%20%20%20%20%20%20%20.mark_rect(opacity%3D0.025)%0A%20%20%20%20%20%20%20%20.encode(%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3D%22date4%3AT%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x2%3D%22date5%3AT%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20color%3Dalt.ColorValue(%22white%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20_is_default_theme_enforced%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20alt.ColorValue(%22black%22)%2C%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20A%20detailed%20view%20on%20the%20first%20highlighted%20area%0A%20%20%20%20_first_sub_chart%20%3D%20_make_chart(%0A%20%20%20%20%20%20%20%20_df%5B(_df.date%20%3E%3D%20_dates%5B0%5D)%20%26%20(_df.date%20%3C%3D%20_dates%5B1%5D)%5D%2C%0A%20%20%20%20%20%20%20%20title%3Df%22From%20%7B_dates%5B0%5D.date()%7D%20to%20%7B_dates%5B1%5D.date()%7D%22%0A%20%20%20%20%20%20%20%20if%20_is_default_theme_enforced%0A%20%20%20%20%20%20%20%20else%20None%2C%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20A%20detailed%20view%20on%20the%20second%20highlighted%20area%0A%20%20%20%20_second_sub_chart%20%3D%20_make_chart(%0A%20%20%20%20%20%20%20%20_df%5B(_df.date%20%3E%3D%20_dates%5B2%5D)%20%26%20(_df.date%20%3C%3D%20_dates%5B3%5D)%5D%2C%0A%20%20%20%20%20%20%20%20title%3Df%22From%20%7B_dates%5B2%5D.date()%7D%20to%20%7B_dates%5B3%5D.date()%7D%22%0A%20%20%20%20%20%20%20%20if%20_is_default_theme_enforced%0A%20%20%20%20%20%20%20%20else%20None%2C%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20A%20detailed%20view%20on%20the%20third%20highlighted%20area%0A%20%20%20%20_third_sub_chart%20%3D%20_make_chart(%0A%20%20%20%20%20%20%20%20_df%5B_df.date%20%3E%3D%20_dates%5B3%5D%5D%2C%0A%20%20%20%20%20%20%20%20title%3Df%22From%20%7B_dates%5B3%5D.date()%7D%20to%20%7B_df.date.max().date()%7D%22%0A%20%20%20%20%20%20%20%20if%20_is_default_theme_enforced%0A%20%20%20%20%20%20%20%20else%20None%2C%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20For%20regular%20use%2C%20one%20could%20now%20just%20compose%20and%20display%20the%0A%20%20%20%20%23%20charts.%20%20For%20a%20static%20HTML%20export%2C%20however%2C%20we%20need%20wo%20work%0A%20%20%20%20%23%20around%20a%20series%20of%20limitations.%20%20Thus%2C%20we'll%20just%20export%20the%0A%20%20%20%20%23%20individual%20charts%20and%20compose%20them%20in%20the%20next%20cell.%0A%20%20%20%20price_chart%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%23%20Default%20version%3B%20that's%20what%20we%20want%20to%20show%0A%20%20%20%20%20%20%20%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20(_full_chart%20%2B%20_highlight0%20%2B%20_highlight1%20%2B%20_highlight2)%0A%20%20%20%20%20%20%20%20%20%20%20%20%26%20(_first_sub_chart%20%7C%20_second_sub_chart%20%7C%20_third_sub_chart)%0A%20%20%20%20%20%20%20%20).properties(%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Requires%20recreation%20if%20this%20layout%20arrangement%20is%20used%0A%20%20%20%20%20%20%20%20%20%20%20%20title%3Df%22GameStop%20Stock%20Prices%20from%20%7B_df.date.min().year%7D%20to%20%7B_df.date.max().year%7D%22%2C%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%23%20The%20following%20pieces%20are%20necessary%20if%20we%20need%20to%20construct%0A%20%20%20%20%20%20%20%20%23%20a%20similar%20layout%20using%20only%20marimo%20ui%20elements%0A%20%20%20%20%20%20%20%20mo.ui.altair_chart(_full_chart%20%2B%20_highlight0%20%2B%20_highlight1%20%2B%20_highlight2)%2C%0A%20%20%20%20%20%20%20%20mo.ui.altair_chart(%0A%20%20%20%20%20%20%20%20%20%20%20%20_first_sub_chart%2C%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20mo.ui.altair_chart(%0A%20%20%20%20%20%20%20%20%20%20%20%20_second_sub_chart%2C%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20mo.ui.altair_chart(%0A%20%20%20%20%20%20%20%20%20%20%20%20_third_sub_chart%2C%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%5D%0A%20%20%20%20return%20(price_chart%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo%2C%20price_chart%2C%20theme)%3A%0A%20%20%20%20%23%20Display%20the%20intende%20plot%20*unless*%20we're%20forced%20to%20work%20with%20the%20default%20theme%0A%20%20%20%20mo.stop(theme.value%20%3D%3D%20%22default%22)%0A%20%20%20%20price_chart%5B0%5D%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo%2C%20price_chart%2C%20theme)%3A%0A%20%20%20%20%23%20Display%20the%20overall%20timeline%20plot%20*if*%20we're%20forced%20to%20work%20with%20the%20default%20theme.%0A%20%20%20%20%23%20Separating%20the%20plots%20is%20necessary%20in%20static%20HTML%20export%20due%20to%20data%20limitations.%0A%20%20%20%20mo.stop(theme.value%20!%3D%20%22default%22)%0A%20%20%20%20price_chart%5B1%5D%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo%2C%20price_chart%2C%20theme)%3A%0A%20%20%20%20%23%20Display%20the%20three%20detail%20charts%20*if*%20we're%20forced%20to%20work%20with%20the%20default%20theme.%0A%20%20%20%20%23%20Separating%20the%20plots%20is%20necessary%20in%20static%20HTML%20export%20due%20to%20data%20limitations.%0A%20%20%20%20mo.stop(theme.value%20!%3D%20%22default%22)%0A%20%20%20%20mo.hstack(price_chart%5B2%3A%5D)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(is_data_loaded%2C%20mo)%3A%0A%20%20%20%20mo.stop(not%20is_data_loaded())%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20It's%20clear%20that%20this%20instability%20at%20the%20end%20in%20all%20four%20price%20columns%20will%0A%20%20%20%20significantly%20affect%20the%20models'%20predictions.%20%20The%20range%20of%20values%20that%20they%0A%20%20%20%20can%20see%20is%20very%20important%20as%20well%3B%20if%20we%20allow%20the%20models%20to%20learn%20primarily%0A%20%20%20%20from%20the%20most%20recent%20developments%2C%20we're%20sure%20to%20see%20an%20unrealistic%0A%20%20%20%20explosion%20of%20stock%20prices%20in%20this%20case.%20%20If%20we%20take%20the%20full%20time%20range%20into%0A%20%20%20%20consideration%2C%20however%2C%20we'd%20expect%20our%20models%20to%20predict%20an%20overly%20quick%0A%20%20%20%20return%20to%20the%20status%20quo%2C%20or%20a%20sudden%20stagnation%20in%20place%20(depending%20on%20the%0A%20%20%20%20choice%20of%20the%20model%20parameters).%20%20Neither%20is%20desirable%20for%20making%20robust%20and%0A%20%20%20%20accurate%20predictions.%0A%0A%20%20%20%20By%20looking%20at%20the%20lower%20right%20graphic%2C%20which%20shows%20the%20rapid%20incline%20of%20the%0A%20%20%20%20prices%20in%20the%20beginning%20of%202021%2C%20we%20can%20see%20that%20December%202020%20was%20still%0A%20%20%20%20pretty%20calm.%20%20Thus%2C%20a%20reasonable%20range%20for%20the%20training%20data%20should%20lie%0A%20%20%20%20within%20one%20to%20few%20months.%0A%0A%20%20%20%20Note%20that%20for%20other%2C%20more%20regular%20kinds%20of%20data%2C%20we%20could%20look%20to%20find%20hints%0A%20%20%20%20for%20sesonal%20behaviour.%20%20In%20that%20case%2C%20the%20range%20should%20definitely%20encompass%0A%20%20%20%20those%20as%20well.%20%20And%20we'd%20use%20a%20SARIMA%20%20model%20instead%20of%20ARIMA.%20%20(The%20absence%0A%20%20%20%20of%20exogenous%20influences%20in%20the%20dataset%20crosses%20out%20ARIMAX%20and%20SARIMAX%0A%20%20%20%20versions.)%0A%0A%20%20%20%20You%20can%20use%20the%20following%20date%20picker%20to%20delimit%20the%20training%20data%20range.%0A%20%20%20%20By%20default%2C%20it's%20set%20to%2090%20business%20days%20prior%20to%20the%20end%20of%20the%20dataset.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(df%2C%20mo)%3A%0A%20%20%20%20%23%20Selectable%20dates%20to%20delimit%20the%20range%20the%20model%20will%20be%20able%20to%20see%0A%20%20%20%20date_limit%20%3D%20mo.ui.date(%0A%20%20%20%20%20%20%20%20start%3Ddf.date.min().date()%2C%0A%20%20%20%20%20%20%20%20stop%3Ddf.date.max().date()%2C%0A%20%20%20%20%20%20%20%20value%3Ddf.date.sort_values(ascending%3DFalse).iloc%5B90%5D.date()%2C%0A%20%20%20%20%20%20%20%20label%3D%22Date%20Visibility%20Limit%22%2C%0A%20%20%20%20)%0A%20%20%20%20date_limit%0A%20%20%20%20return%20(date_limit%2C)%0A%0A%0A%40app.cell%0Adef%20_(is_data_loaded%2C%20mo)%3A%0A%20%20%20%20mo.stop(not%20is_data_loaded())%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20Next%2C%20ARIMA%20models%20rely%20on%20three%20important%20parameters%20or%20_orders_%20for%20their%0A%20%20%20%20prediction.%0A%0A%20%20%20%20ARIMA%20stands%20for%20**A**uto**R**egressive%20**I**ntegrated%20**M**oving%20**A**verage.%0A%20%20%20%20In%20short%2C%20the%20algorithm%20predicts%20future%20steps%20based%20on%20three%20influence%0A%20%20%20%20factors%3A%0A%0A%20%20%20%20-%20Autocorrelation%3Cbr%2F%3E%0A%20%20%20%20%20%20Future%20values%20are%20influenced%20by%20past%20values.%0A%20%20%20%20-%20Integration%3Cbr%2F%3E%0A%20%20%20%20%20%20Past%20data%20points%20are%20not%20independent%20from%20each%20other%2C%20either%3B%20influences%0A%20%20%20%20%20%20carry%20through%20and%20an%20integration%20term%20takes%20care%20of%20that.%0A%20%20%20%20-%20Moving%20Average%3Cbr%2F%3E%0A%20%20%20%20%20%20The%20underlying%20motion%20of%20the%20data%20is%20not%20captured%20by%20immediately%0A%20%20%20%20%20%20subsequent%20datapoints%2C%20but%20can%20be%20caputred%20by%20observing%20the%20average%20across%0A%20%20%20%20%20%20a%20certain%20time%20window.%0A%0A%20%20%20%20The%20three%20parameters%20are%20%24p%24%2C%20the%20autocorrelation%20order%2C%20%24d%24%2C%20the%0A%20%20%20%20integration%20order%2C%20and%20%24q%24%2C%20the%20moving%20average%20order.%20%20I%20will%20not%20go%20into%0A%20%20%20%20detail%20how%20they%20work%20or%20how%20to%20choose%20them%20correctly.%20%20The%20choice%20depends%0A%20%20%20%20heavily%20on%20the%20data%20itself.%20%20In%20practice%2C%20you%20use%20so-called%20ACF%0A%20%20%20%20(autocorrelation%2C%20https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FAutocorrelation)%20and%20PACF%0A%20%20%20%20(partial%20autocorrelation%2C%20https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FPartial_autocorrelation_function)%0A%20%20%20%20plots%20to%20find%20reasonable%20candidates.%20%20Then%2C%20you%20explore%20around%20them%20to%20find%0A%20%20%20%20the%20configuration%20that%20yields%20the%20best%20results.%0A%0A%20%20%20%20I%20recommend%20%5Bthis%20article%5D(https%3A%2F%2Fpeople.duke.edu%2F~rnau%2F411arim3.htm)%20for%20a%0A%20%20%20%20detailed%20explanation%20of%20the%20process%20with%20an%20example%2C%20as%20well%20as%20a%20few%20rules%0A%20%20%20%20of%20thumb.%0A%0A%20%20%20%20You%20can%20freely%20experiment%20with%20the%20orders%20and%20the%20effects%20they%20have%20on%20the%0A%20%20%20%20models'%20predictions%20with%20the%20sliders%20below.%20%20The%20defaults%20%24(p%2C%20d%2C%20q)%20%3D%0A%20%20%20%20(0%2C%202%2C%201)%24%20are%20the%20best%20candidates%20for%20the%20concrete%20time%20range%20chosen%20by%0A%20%20%20%20default.%20%20If%20you%20play%20around%20with%20other%20time%20scales%2C%20other%20orders%20may%20yield%0A%20%20%20%20better%20results.%20%20At%20least%20in%20this%20concrete%20example%20with%20a%20strong%0A%20%20%20%20irregularity%20at%20the%20end.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20Create%20states%2C%20accessors%20and%20mutators%20for%20the%20ARIMA%20orders%0A%20%20%20%20get_p%2C%20set_p%20%3D%20mo.state(0)%0A%20%20%20%20get_d%2C%20set_d%20%3D%20mo.state(2)%0A%20%20%20%20get_q%2C%20set_q%20%3D%20mo.state(1)%0A%20%20%20%20return%20get_d%2C%20get_p%2C%20get_q%2C%20set_d%2C%20set_p%2C%20set_q%0A%0A%0A%40app.cell%0Adef%20_(get_p%2C%20mo%2C%20set_p)%3A%0A%20%20%20%20%23%20Create%20slider%20for%20ARIMA%20order%20p%0A%20%20%20%20p%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0%2C%0A%20%20%20%20%20%20%20%20stop%3D10%2C%0A%20%20%20%20%20%20%20%20step%3D1%2C%0A%20%20%20%20%20%20%20%20value%3Dget_p()%2C%0A%20%20%20%20%20%20%20%20on_change%3Dset_p%2C%0A%20%20%20%20%20%20%20%20label%3D%22p%22%2C%0A%20%20%20%20%20%20%20%20show_value%3DTrue%2C%0A%20%20%20%20)%0A%20%20%20%20return%20(p%2C)%0A%0A%0A%40app.cell%0Adef%20_(get_p%2C%20mo%2C%20set_p)%3A%0A%20%20%20%20%23%20Create%20increment%2F%20decrement%20buttons%20for%20ARIMA%20order%20p%0A%20%20%20%20button_increment_p%20%3D%20mo.ui.button(%0A%20%20%20%20%20%20%20%20label%3D%22%2B%22%2C%0A%20%20%20%20%20%20%20%20on_click%3Dlambda%20_%3A%20set_p(int(min(10%2C%20get_p()%20%2B%201)))%2C%0A%20%20%20%20)%0A%20%20%20%20button_decrement_p%20%3D%20mo.ui.button(%0A%20%20%20%20%20%20%20%20label%3D%22-%22%2C%0A%20%20%20%20%20%20%20%20on_click%3Dlambda%20_%3A%20set_p(int(max(0%2C%20get_p()%20-%201)))%2C%0A%20%20%20%20)%0A%20%20%20%20return%20button_decrement_p%2C%20button_increment_p%0A%0A%0A%40app.cell%0Adef%20_(get_d%2C%20mo%2C%20set_d)%3A%0A%20%20%20%20%23%20Create%20increment%2F%20decrement%20buttons%20for%20ARIMA%20order%20d%0A%20%20%20%20button_increment_d%20%3D%20mo.ui.button(%0A%20%20%20%20%20%20%20%20label%3D%22%2B%22%2C%0A%20%20%20%20%20%20%20%20on_click%3Dlambda%20_%3A%20set_d(int(min(10%2C%20get_d()%20%2B%201)))%2C%0A%20%20%20%20)%0A%20%20%20%20button_decrement_d%20%3D%20mo.ui.button(%0A%20%20%20%20%20%20%20%20label%3D%22-%22%2C%0A%20%20%20%20%20%20%20%20on_click%3Dlambda%20_%3A%20set_d(int(max(0%2C%20get_d()%20-%201)))%2C%0A%20%20%20%20)%0A%20%20%20%20return%20button_decrement_d%2C%20button_increment_d%0A%0A%0A%40app.cell%0Adef%20_(get_q%2C%20mo%2C%20set_q)%3A%0A%20%20%20%20%23%20Create%20increment%2F%20decrement%20buttons%20for%20ARIMA%20order%20q%0A%20%20%20%20button_increment_q%20%3D%20mo.ui.button(%0A%20%20%20%20%20%20%20%20label%3D%22%2B%22%2C%0A%20%20%20%20%20%20%20%20on_click%3Dlambda%20_%3A%20set_q(int(min(10%2C%20get_q()%20%2B%201)))%2C%0A%20%20%20%20)%0A%20%20%20%20button_decrement_q%20%3D%20mo.ui.button(%0A%20%20%20%20%20%20%20%20label%3D%22-%22%2C%0A%20%20%20%20%20%20%20%20on_click%3Dlambda%20_%3A%20set_q(int(max(0%2C%20get_q()%20-%201)))%2C%0A%20%20%20%20)%0A%20%20%20%20return%20button_decrement_q%2C%20button_increment_q%0A%0A%0A%40app.cell%0Adef%20_(get_d%2C%20mo%2C%20set_d)%3A%0A%20%20%20%20%23%20Create%20slider%20for%20ARIMA%20order%20d%0A%20%20%20%20d%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0%2C%0A%20%20%20%20%20%20%20%20stop%3D10%2C%0A%20%20%20%20%20%20%20%20step%3D1%2C%0A%20%20%20%20%20%20%20%20value%3Dget_d()%2C%0A%20%20%20%20%20%20%20%20on_change%3Dset_d%2C%0A%20%20%20%20%20%20%20%20label%3D%22d%22%2C%0A%20%20%20%20%20%20%20%20show_value%3DTrue%2C%0A%20%20%20%20)%0A%20%20%20%20return%20(d%2C)%0A%0A%0A%40app.cell%0Adef%20_(get_q%2C%20mo%2C%20set_q)%3A%0A%20%20%20%20%23%20Create%20slider%20for%20ARIMA%20order%20q%0A%20%20%20%20q%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0%2C%0A%20%20%20%20%20%20%20%20stop%3D10%2C%0A%20%20%20%20%20%20%20%20step%3D1%2C%0A%20%20%20%20%20%20%20%20value%3Dget_q()%2C%0A%20%20%20%20%20%20%20%20on_change%3Dset_q%2C%0A%20%20%20%20%20%20%20%20label%3D%22q%22%2C%0A%20%20%20%20%20%20%20%20show_value%3DTrue%2C%0A%20%20%20%20)%0A%20%20%20%20return%20(q%2C)%0A%0A%0A%40app.cell%0Adef%20_(ARIMA%2C%20d%2C%20date_limit%2C%20df%2C%20p%2C%20pd%2C%20pretty%2C%20q)%3A%0A%20%20%20%20%23%20Create%20a%20subset%20of%20data%20from%20the%20original%20frame%20to%20show%20the%20models%0A%20%20%20%20_data%20%3D%20df.drop(%22date%22%2C%20axis%3D1)%5B%0A%20%20%20%20%20%20%20%20df.date%20%3E%3D%20pd.to_datetime(date_limit.value)%0A%20%20%20%20%5D.sort_values(%22date%22%2C%20ascending%3DTrue)%0A%0A%20%20%20%20%23%20Create%20and%20fit%20ARIMA%20models%20for%20each%20price%20series%0A%20%20%20%20model%20%3D%20%7B%0A%20%20%20%20%20%20%20%20col%3A%20ARIMA(%0A%20%20%20%20%20%20%20%20%20%20%20%20endog%3D_data%5Bcol%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20order%3D(p.value%2C%20d.value%2C%20q.value)%2C%0A%20%20%20%20%20%20%20%20).fit()%0A%20%20%20%20%20%20%20%20for%20col%20in%20list(pretty.keys())%5B1%3A5%5D%0A%20%20%20%20%7D%0A%20%20%20%20return%20(model%2C)%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20button_decrement_d%2C%0A%20%20%20%20button_decrement_p%2C%0A%20%20%20%20button_decrement_q%2C%0A%20%20%20%20button_increment_d%2C%0A%20%20%20%20button_increment_p%2C%0A%20%20%20%20button_increment_q%2C%0A%20%20%20%20d%2C%0A%20%20%20%20mo%2C%0A%20%20%20%20p%2C%0A%20%20%20%20q%2C%0A)%3A%0A%20%20%20%20%23%20Display%20the%20ARIMA%20order%20controls%0A%20%20%20%20_widths%20%3D%20%5B1%2C%200.5%2C%2010%5D%0A%20%20%20%20mo.vstack(%0A%20%20%20%20%20%20%20%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.hstack(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bp%2C%20button_decrement_p%2C%20button_increment_p%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20widths%3D_widths%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.hstack(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bd%2C%20button_decrement_d%2C%20button_increment_d%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20widths%3D_widths%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.hstack(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bq%2C%20button_decrement_q%2C%20button_increment_q%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20widths%3D_widths%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20Create%20a%20slider%20to%20select%20the%20number%20of%20prediction%20steps%0A%20%20%20%20steps%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D5%2C%0A%20%20%20%20%20%20%20%20stop%3D45%2C%0A%20%20%20%20%20%20%20%20step%3D5%2C%0A%20%20%20%20%20%20%20%20value%3D30%2C%0A%20%20%20%20%20%20%20%20label%3D%22Predictions%20(days)%22%2C%0A%20%20%20%20%20%20%20%20show_value%3DTrue%2C%0A%20%20%20%20)%0A%20%20%20%20steps%0A%20%20%20%20return%20(steps%2C)%0A%0A%0A%40app.cell%0Adef%20_(df%2C%20model%2C%20pd%2C%20steps)%3A%0A%20%20%20%20%23%20Create%20a%20time%20range%20for%20the%20forecasts%0A%20%20%20%20prediction_dates%20%3D%20pd.date_range(%0A%20%20%20%20%20%20%20%20df.date.max()%2C%0A%20%20%20%20%20%20%20%20periods%3Dsteps.value%20%2B%201%2C%0A%20%20%20%20%20%20%20%20freq%3D%22B%22%2C%20%20%23%20Business%20days%0A%20%20%20%20)%5B1%3A%5D%20%20%23%20Exclude%20the%20first%20one%3B%20we%20don't%20predict%20the%20value%20we%20already%20have%0A%0A%20%20%20%20%23%20Use%20the%20models%20to%20create%20forcasts%20for%20each%20price%20column%0A%20%20%20%20prediction%20%3D%20%7B%0A%20%20%20%20%20%20%20%20col%3A%20pd.DataFrame(%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Date%22%3A%20prediction_dates%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20col%3A%20model%5Bcol%5D.forecast(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20steps%3Dsteps.value%2C%20index%3Drange(steps.value)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20for%20col%20in%20model.keys()%0A%20%20%20%20%7D%0A%20%20%20%20return%20(prediction%2C)%0A%0A%0A%40app.cell%0Adef%20_(is_data_loaded%2C%20mo)%3A%0A%20%20%20%20mo.stop(not%20is_data_loaded())%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20To%20fully%20visualise%20the%20models'%20preditions%2C%20we%20don't%20want%20to%20plot%20all%20price%0A%20%20%20%20columns%20on%20top%20of%20each%20other%2C%20but%20individually.%20%20You%20can%20choose%20which%20one%0A%20%20%20%20to%20plot%20using%20this%20little%20drop-down%20menu%3A%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo%2C%20pretty)%3A%0A%20%20%20%20%23%20Create%20a%20dropdown%20menu%20for%20selecting%20the%20price%20column%20we%20want%20to%20display.%0A%20%20%20%20%23%20(We%20want%20to%20see%20a%20few%20more%20details%20here.)%0A%20%20%20%20_options%20%3D%20list(pretty.values())%5B1%3A5%5D%0A%20%20%20%20column%20%3D%20mo.ui.dropdown(%0A%20%20%20%20%20%20%20%20options%3D_options%2C%0A%20%20%20%20%20%20%20%20label%3D%22Column%22%2C%0A%20%20%20%20%20%20%20%20value%3D_options%5B-1%5D%2C%0A%20%20%20%20)%0A%20%20%20%20column%0A%20%20%20%20return%20(column%2C)%0A%0A%0A%40app.cell%0Adef%20_(alt%2C%20column%2C%20mo%2C%20pretty%2C%20synthesized%2C%20theme)%3A%0A%20%20%20%20%23%20Shortcut%20for%20the%20Pythonic%20column%20value%20for%20the%20selected%20column%0A%20%20%20%20_column%20%3D%20%5Bkey%20for%20key%2C%20value%20in%20pretty.items()%20if%20value%20%3D%3D%20column.value%5D%5B0%5D%0A%0A%20%20%20%20%23%20Activate%20the%20theme%20(in%20case%20it%20has%20been%20changed)%0A%20%20%20%20if%20theme.value%20!%3D%20%22default%22%3A%0A%20%20%20%20%20%20%20%20alt.theme.enable(theme.value)%0A%0A%20%20%20%20%23%20Create%20a%20base%20Chart%20object%20to%20be%20shared%20across%20granular%20settings%3B%0A%20%20%20%20%23%20This%20approach%20is%20necessary%20to%20reflect%20respective%20styles%20in%20a%20legend%0A%20%20%20%20_base%20%3D%20(%0A%20%20%20%20%20%20%20%20alt.Chart(synthesized)%0A%20%20%20%20%20%20%20%20.transform_fold(%20%20%23%20Fold%20the%20values%20into%20a%20single%20column%0A%20%20%20%20%20%20%20%20%20%20%20%20synthesized.columns%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20as_%3D%5B%22column%22%2C%20%22value%22%5D%2C%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20.encode(%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dalt.X(%22date%3AT%22).title(%22Date%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20color%3Dalt.Color(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22column%3AN%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20title%3Dcolumn.value%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20scale%3Dalt.Scale(%20%20%23%20Manually%20assign%20colors%20to%20columns%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20domain%3D%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22%7B_column%7D%20(original)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22%7B_column%7D%20(predicted)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22%7B_column%7D%20(continued)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20range%3D%5B%22skyblue%22%2C%20%22%2303A9F4%22%2C%20%22lightblue%22%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20strokeDash%3Dalt.StrokeDash(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22column%3AN%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20scale%3Dalt.Scale(%20%20%23%20Manually%20assign%20stroke%20patterns%20to%20columns%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20domain%3D%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22%7B_column%7D%20(original)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22%7B_column%7D%20(predicted)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22%7B_column%7D%20(continued)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20range%3D%5B0%2C%200%2C%20%5B1%2C%201%5D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Compose%20and%20display%20the%20chart%0A%20%20%20%20mo.ui.altair_chart(%0A%20%20%20%20%20%20%20%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Original%20data%0A%20%20%20%20%20%20%20%20%20%20%20%20_base.mark_line()%0A%20%20%20%20%20%20%20%20%20%20%20%20.transform_filter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alt.datum.column%20%3D%3D%20f%22%7B_column%7D%20(original)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20.encode(y%3Dalt.Y(%22value%3AQ%22).title(column.value))%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Predictions%0A%20%20%20%20%20%20%20%20%20%20%20%20%2B%20_base.mark_line()%0A%20%20%20%20%20%20%20%20%20%20%20%20.transform_filter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alt.datum.column%20%3D%3D%20f%22%7B_column%7D%20(predicted)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20.encode(y%3Dalt.Y(%22value%3AQ%22).title(column.value))%0A%20%20%20%20%20%20%20%20%20%20%20%20.properties(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20title%3Df%22Prediction%3A%20%7Bcolumn.value%7D%20from%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20f%22%7Bsynthesized.date.min().date()%7D%20to%20%7Bsynthesized.date.max().date()%7D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Continuation%0A%20%20%20%20%20%20%20%20%20%20%20%20%2B%20_base.mark_line()%0A%20%20%20%20%20%20%20%20%20%20%20%20.transform_filter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alt.datum.column%20%3D%3D%20f%22%7B_column%7D%20(continued)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20.encode(y%3Dalt.Y(%22value%3AQ%22).title(column.value))%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(is_data_loaded%2C%20mo)%3A%0A%20%20%20%20mo.stop(not%20is_data_loaded())%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20Upon%20closer%20inspection%2C%20you%20may%20have%20noticed%20the%20dotted%20%22continued%22%20line.%0A%20%20%20%20This%20part%20stems%20from%20data%20I%20scraped%20from%20https%3A%2F%2Fwww.statmuse.com.%20%20While%0A%20%20%20%20not%20exactly%20the%20same%20recorded%20data%2C%20the%20numbers%20between%20the%20two%20data%20sources%0A%20%20%20%20are%20*closely%20related*.%20%20In%20fact%2C%20they%20differ%20only%20by%20a%20scaling%20factor.%0A%0A%20%20%20%20One%20could%20numerically%20compute%20the%20scaling%20through%20comparing%20the%20overlap%20that%0A%20%20%20%20I%20intentionally%20included%20for%20comparability%20through%20linear%20regression.%20%20But%0A%20%20%20%20for%20the%20sake%20of%20this%20little%20demo%2C%20an%20interactive%20slider%20shall%20do%20the%20trick%3A%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20Introduce%20a%20scale%20state%20to%20synchronise%20various%20UI%20contols.%0A%20%20%20%20%23%20Note%20that%20controls%20and%20states%20all%20must%20be%20created%20in%20individual%20cells%0A%20%20%20%20%23%20for%20the%20synchronisation%20to%20work%20properly.%0A%20%20%20%20get_scale%2C%20set_scale%20%3D%20mo.state(4)%0A%20%20%20%20return%20get_scale%2C%20set_scale%0A%0A%0A%40app.cell%0Adef%20_(get_scale%2C%20mo%2C%20set_scale)%3A%0A%20%20%20%20%23%20Create%20a%20scale%20slider%20to%20align%20the%20stock%20values%20of%20the%20two%20different%0A%20%20%20%20%23%20datasets%20(from%20different%20sources)%0A%20%20%20%20scale%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D1%2C%0A%20%20%20%20%20%20%20%20stop%3D10%2C%0A%20%20%20%20%20%20%20%20step%3D0.1%2C%0A%20%20%20%20%20%20%20%20value%3Dget_scale()%2C%0A%20%20%20%20%20%20%20%20on_change%3Dset_scale%2C%0A%20%20%20%20%20%20%20%20show_value%3DTrue%2C%0A%20%20%20%20)%0A%20%20%20%20return%20(scale%2C)%0A%0A%0A%40app.cell%0Adef%20_(get_scale%2C%20mo%2C%20set_scale)%3A%0A%20%20%20%20%23%20Create%20buttons%20in%20increment%2F%20decrement%20the%20scale%20value%20stepwise.%0A%20%20%20%20%23%20This%20should%20smoothen%20the%20user%20experience%20a%20bit.%0A%20%20%20%20button_increment_scale%20%3D%20mo.ui.button(%0A%20%20%20%20%20%20%20%20label%3D%22%2B%22%2C%0A%20%20%20%20%20%20%20%20on_click%3Dlambda%20_%3A%20set_scale(round(min(get_scale()%20%2B%200.1%2C%2010)%2C%201))%2C%0A%20%20%20%20)%0A%20%20%20%20button_decrement_scale%20%3D%20mo.ui.button(%0A%20%20%20%20%20%20%20%20label%3D%22-%22%2C%0A%20%20%20%20%20%20%20%20on_click%3Dlambda%20_%3A%20set_scale(round(max(get_scale()%20-%200.1%2C%201)%2C%201))%2C%0A%20%20%20%20)%0A%20%20%20%20return%20button_decrement_scale%2C%20button_increment_scale%0A%0A%0A%40app.cell%0Adef%20_(button_decrement_scale%2C%20button_increment_scale%2C%20mo%2C%20scale)%3A%0A%20%20%20%20%23%20Display%20the%20synchronised%20controls%0A%20%20%20%20mo.hstack(%0A%20%20%20%20%20%20%20%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20scale%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20button_decrement_scale%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20button_increment_scale%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Scaling%20factor%20for%20the%20continued%20dataset.%20%20(Makes%20the%20lines%20overlap%20in%20the%20graphic.)%22%0A%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%5D%2C%0A%20%20%20%20%20%20%20%20widths%3D%5B3%2C%200.5%2C%201%2C%2015%5D%2C%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(pd%2C%20scale)%3A%0A%20%20%20%20%23%20Read%20continuation%20data%0A%20%20%20%20%23%20continuation%20%3D%20pd.read_csv('data%2Fcontinuation.csv')%0A%0A%20%20%20%20%23%20For%20the%20static%20website%20export%2C%20I%20include%20the%20data%20directly%20inside%20the%0A%20%20%20%20%23%20notebook%20for%20a%20smoother%20user%20experience%20and%20to%20avoid%20file%20system%20issues.%0A%20%20%20%20%23%20(The%20regular%20approach%20fails%20in%20the%20statically%20exported%20HTML%20version.)%0A%20%20%20%20import%20json%0A%0A%20%20%20%20_embedded_data_string%20%3D%20'%7B%22Date%22%3A%7B%220%22%3A%222021-01-04%22%2C%221%22%3A%222021-01-05%22%2C%222%22%3A%222021-01-06%22%2C%223%22%3A%222021-01-07%22%2C%224%22%3A%222021-01-08%22%2C%225%22%3A%222021-01-11%22%2C%226%22%3A%222021-01-12%22%2C%227%22%3A%222021-01-13%22%2C%228%22%3A%222021-01-14%22%2C%229%22%3A%222021-01-15%22%2C%2210%22%3A%222021-01-19%22%2C%2211%22%3A%222021-01-20%22%2C%2212%22%3A%222021-01-21%22%2C%2213%22%3A%222021-01-22%22%2C%2214%22%3A%222021-01-25%22%2C%2215%22%3A%222021-01-26%22%2C%2216%22%3A%222021-01-27%22%2C%2217%22%3A%222021-01-28%22%2C%2218%22%3A%222021-01-29%22%2C%2219%22%3A%222021-02-01%22%2C%2220%22%3A%222021-02-02%22%2C%2221%22%3A%222021-02-03%22%2C%2222%22%3A%222021-02-04%22%2C%2223%22%3A%222021-02-05%22%2C%2224%22%3A%222021-02-08%22%2C%2225%22%3A%222021-02-09%22%2C%2226%22%3A%222021-02-10%22%2C%2227%22%3A%222021-02-11%22%2C%2228%22%3A%222021-02-12%22%2C%2229%22%3A%222021-02-16%22%2C%2230%22%3A%222021-02-17%22%2C%2231%22%3A%222021-02-18%22%2C%2232%22%3A%222021-02-19%22%2C%2233%22%3A%222021-02-22%22%2C%2234%22%3A%222021-02-23%22%2C%2235%22%3A%222021-02-24%22%2C%2236%22%3A%222021-02-25%22%2C%2237%22%3A%222021-02-26%22%2C%2238%22%3A%222021-03-01%22%2C%2239%22%3A%222021-03-02%22%2C%2240%22%3A%222021-03-03%22%2C%2241%22%3A%222021-03-04%22%2C%2242%22%3A%222021-03-05%22%2C%2243%22%3A%222021-03-08%22%2C%2244%22%3A%222021-03-09%22%2C%2245%22%3A%222021-03-10%22%2C%2246%22%3A%222021-03-11%22%2C%2247%22%3A%222021-03-12%22%2C%2248%22%3A%222021-03-15%22%2C%2249%22%3A%222021-03-16%22%2C%2250%22%3A%222021-03-17%22%2C%2251%22%3A%222021-03-18%22%2C%2252%22%3A%222021-03-19%22%2C%2253%22%3A%222021-03-22%22%2C%2254%22%3A%222021-03-23%22%2C%2255%22%3A%222021-03-24%22%2C%2256%22%3A%222021-03-25%22%2C%2257%22%3A%222021-03-26%22%2C%2258%22%3A%222021-03-29%22%2C%2259%22%3A%222021-03-30%22%2C%2260%22%3A%222021-03-31%22%7D%2C%22Open%22%3A%7B%220%22%3A4.75%2C%221%22%3A4.34%2C%222%22%3A4.34%2C%223%22%3A4.62%2C%224%22%3A4.55%2C%225%22%3A4.85%2C%226%22%3A4.99%2C%227%22%3A5.11%2C%228%22%3A9.52%2C%229%22%3A9.62%2C%2210%22%3A10.39%2C%2211%22%3A9.34%2C%2212%22%3A9.91%2C%2213%22%3A10.65%2C%2214%22%3A24.18%2C%2215%22%3A22.14%2C%2216%22%3A88.71%2C%2217%22%3A66.25%2C%2218%22%3A94.93%2C%2219%22%3A79.14%2C%2220%22%3A35.19%2C%2221%22%3A28.0%2C%2222%22%3A22.8%2C%2223%22%3A13.51%2C%2224%22%3A18.1%2C%2225%22%3A14.15%2C%2226%22%3A12.69%2C%2227%22%3A12.5%2C%2228%22%3A12.69%2C%2229%22%3A13.17%2C%2230%22%3A12.44%2C%2231%22%3A12.12%2C%2232%22%3A10.32%2C%2233%22%3A11.67%2C%2234%22%3A11.24%2C%2235%22%3A11.18%2C%2236%22%3A42.39%2C%2237%22%3A29.37%2C%2238%22%3A26.14%2C%2239%22%3A29.23%2C%2240%22%3A30.63%2C%2241%22%3A31.25%2C%2242%22%3A32.04%2C%2243%22%3A38.72%2C%2244%22%3A54.43%2C%2245%22%3A67.36%2C%2246%22%3A60.41%2C%2247%22%3A68.75%2C%2248%22%3A69.38%2C%2249%22%3A50.79%2C%2250%22%3A54.46%2C%2251%22%3A53.5%2C%2252%22%3A48.93%2C%2253%22%3A51.32%2C%2254%22%3A49.38%2C%2255%22%3A39.5%2C%2256%22%3A30.87%2C%2257%22%3A49.42%2C%2258%22%3A45.19%2C%2259%22%3A46.88%2C%2260%22%3A49.38%7D%2C%22High%22%3A%7B%220%22%3A4.78%2C%221%22%3A4.52%2C%222%22%3A4.75%2C%223%22%3A4.86%2C%224%22%3A4.58%2C%225%22%3A5.16%2C%226%22%3A5.1%2C%227%22%3A9.66%2C%228%22%3A10.77%2C%229%22%3A10.19%2C%2210%22%3A11.38%2C%2211%22%3A10.3%2C%2212%22%3A11.19%2C%2213%22%3A19.19%2C%2214%22%3A39.8%2C%2215%22%3A37.5%2C%2216%22%3A95.0%2C%2217%22%3A120.75%2C%2218%22%3A103.5%2C%2219%22%3A80.5%2C%2220%22%3A39.5%2C%2221%22%3A28.35%2C%2222%22%3A22.88%2C%2223%22%3A23.75%2C%2224%22%3A18.17%2C%2225%22%3A14.25%2C%2226%22%3A15.71%2C%2227%22%3A13.83%2C%2228%22%3A13.81%2C%2229%22%3A13.38%2C%2230%22%3A12.8%2C%2231%22%3A12.22%2C%2232%22%3A10.97%2C%2233%22%3A12.13%2C%2234%22%3A11.56%2C%2235%22%3A22.93%2C%2236%22%3A46.17%2C%2237%22%3A35.73%2C%2238%22%3A33.5%2C%2239%22%3A33.3%2C%2240%22%3A31.94%2C%2241%22%3A36.97%2C%2242%22%3A37.88%2C%2243%22%3A52.72%2C%2244%22%3A62.46%2C%2245%22%3A87.13%2C%2246%22%3A70.38%2C%2247%22%3A73.88%2C%2248%22%3A70.75%2C%2249%22%3A55.18%2C%2250%22%3A57.87%2C%2251%22%3A54.72%2C%2252%22%3A56.75%2C%2253%22%3A52.59%2C%2254%22%3A50.44%2C%2255%22%3A41.74%2C%2256%22%3A46.88%2C%2257%22%3A54.79%2C%2258%22%3A48.48%2C%2259%22%3A51.08%2C%2260%22%3A49.87%7D%2C%22Low%22%3A%7B%220%22%3A4.29%2C%221%22%3A4.31%2C%222%22%3A4.33%2C%223%22%3A4.51%2C%224%22%3A4.27%2C%225%22%3A4.75%2C%226%22%3A4.83%2C%227%22%3A5.01%2C%228%22%3A8.26%2C%229%22%3A8.5%2C%2210%22%3A9.16%2C%2211%22%3A9.02%2C%2212%22%3A9.25%2C%2213%22%3A10.58%2C%2214%22%3A15.28%2C%2215%22%3A20.05%2C%2216%22%3A62.25%2C%2217%22%3A28.06%2C%2218%22%3A62.5%2C%2219%22%3A53.0%2C%2220%22%3A18.56%2C%2221%22%3A21.31%2C%2222%22%3A13.33%2C%2223%22%3A12.77%2C%2224%22%3A14.51%2C%2225%22%3A11.63%2C%2226%22%3A11.64%2C%2227%22%3A12.06%2C%2228%22%3A12.01%2C%2229%22%3A12.26%2C%2230%22%3A11.14%2C%2231%22%3A10.16%2C%2232%22%3A9.63%2C%2233%22%3A10.6%2C%2234%22%3A10.0%2C%2235%22%3A11.18%2C%2236%22%3A25.25%2C%2237%22%3A21.5%2C%2238%22%3A24.99%2C%2239%22%3A28.05%2C%2240%22%3A28.28%2C%2241%22%3A28.83%2C%2242%22%3A31.88%2C%2243%22%3A36.53%2C%2244%22%3A52.13%2C%2245%22%3A43.0%2C%2246%22%3A58.15%2C%2247%22%3A65.57%2C%2248%22%3A51.5%2C%2249%22%3A43.09%2C%2250%22%3A51.0%2C%2251%22%3A48.91%2C%2252%22%3A45.67%2C%2253%22%3A46.55%2C%2254%22%3A44.39%2C%2255%22%3A29.66%2C%2256%22%3A29.23%2C%2257%22%3A40.82%2C%2258%22%3A43.38%2C%2259%22%3A54.5%2C%2260%22%3A46.78%7D%2C%22Close%22%3A%7B%220%22%3A4.31%2C%221%22%3A4.34%2C%222%22%3A4.59%2C%223%22%3A4.52%2C%224%22%3A4.42%2C%225%22%3A4.99%2C%226%22%3A4.99%2C%227%22%3A7.85%2C%228%22%3A9.98%2C%229%22%3A8.88%2C%2210%22%3A9.84%2C%2211%22%3A9.78%2C%2212%22%3A10.76%2C%2213%22%3A16.25%2C%2214%22%3A19.2%2C%2215%22%3A37.0%2C%2216%22%3A86.88%2C%2217%22%3A48.4%2C%2218%22%3A81.25%2C%2219%22%3A56.25%2C%2220%22%3A22.5%2C%2221%22%3A23.1%2C%2222%22%3A13.38%2C%2223%22%3A15.94%2C%2224%22%3A15.0%2C%2225%22%3A12.58%2C%2226%22%3A12.8%2C%2227%22%3A12.78%2C%2228%22%3A13.1%2C%2229%22%3A12.38%2C%2230%22%3A11.49%2C%2231%22%3A10.17%2C%2232%22%3A10.15%2C%2233%22%3A11.5%2C%2234%22%3A11.24%2C%2235%22%3A22.93%2C%2236%22%3A27.18%2C%2237%22%3A25.44%2C%2238%22%3A24.99%2C%2239%22%3A28.05%2C%2240%22%3A28.28%2C%2241%22%3A28.83%2C%2242%22%3A31.88%2C%2243%22%3A36.53%2C%2244%22%3A52.13%2C%2245%22%3A43.0%2C%2246%22%3A58.15%2C%2247%22%3A65.57%2C%2248%22%3A51.5%2C%2249%22%3A43.09%2C%2250%22%3A52.45%2C%2251%22%3A50.44%2C%2252%22%3A50.07%2C%2253%22%3A48.62%2C%2254%22%3A45.44%2C%2255%22%3A30.09%2C%2256%22%3A45.94%2C%2257%22%3A45.25%2C%2258%22%3A45.33%2C%2259%22%3A48.62%2C%2260%22%3A47.46%7D%2C%22Volume%22%3A%7B%220%22%3A40089880%2C%221%22%3A19845828%2C%222%22%3A24224992%2C%223%22%3A24517104%2C%224%22%3A25927840%2C%225%22%3A59710440%2C%226%22%3A28242660%2C%227%22%3A578006812%2C%228%22%3A374869624%2C%229%22%3A187465436%2C%2210%22%3A298887688%2C%2211%22%3A133887156%2C%2212%22%3A228319016%2C%2213%22%3A788631624%2C%2214%22%3A711496000%2C%2215%22%3A714352000%2C%2216%22%3A373586688%2C%2217%22%3A235263236%2C%2218%22%3A202264236%2C%2219%22%3A149528608%2C%2220%22%3A312732280%2C%2221%22%3A170794048%2C%2222%22%3A249709124%2C%2223%22%3A325380032%2C%2224%22%3A102749116%2C%2225%22%3A107372320%2C%2226%22%3A145820156%2C%2227%22%3A52226920%2C%2228%22%3A58293040%2C%2229%22%3A32700120%2C%2230%22%3A37043180%2C%2231%22%3A95962244%2C%2232%22%3A59312960%2C%2233%22%3A77904080%2C%2234%22%3A30260860%2C%2235%22%3A332446968%2C%2236%22%3A601235188%2C%2237%22%3A368776592%2C%2238%22%3A199175876%2C%2239%22%3A135132156%2C%2240%22%3A77095524%2C%2241%22%3A130427564%2C%2242%22%3A122934680%2C%2243%22%3A254262484%2C%2244%22%3A156397312%2C%2245%22%3A286282280%2C%2246%22%3A113249960%2C%2247%22%3A103383600%2C%2248%22%3A96904756%2C%2249%22%3A141691484%2C%2250%22%3A65926360%2C%2251%22%3A47199640%2C%2252%22%3A98709204%2C%2253%22%3A40246040%2C%2254%22%3A57716600%2C%2255%22%3A96711524%2C%2256%22%3A203849360%2C%2257%22%3A149722688%2C%2258%22%3A40168720%2C%2259%22%3A68379680%2C%2260%22%3A33575336%7D%7D'%0A%0A%20%20%20%20continuation%20%3D%20pd.DataFrame(json.loads(_embedded_data_string))%0A%20%20%20%20continuation.columns%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%22date%22%2C%0A%20%20%20%20%20%20%20%20%22open_price%22%2C%0A%20%20%20%20%20%20%20%20%22high_price%22%2C%0A%20%20%20%20%20%20%20%20%22low_price%22%2C%0A%20%20%20%20%20%20%20%20%22close_price%22%2C%0A%20%20%20%20%20%20%20%20%22volume%22%2C%0A%20%20%20%20%5D%0A%20%20%20%20continuation.date%20%3D%20pd.to_datetime(continuation.date)%0A%0A%20%20%20%20%23%20The%20column%20values%20of%20the%20datasets%20aren't%20identical%2C%20but%20*related*%3B%0A%20%20%20%20%23%20We%20need%20to%20scale%20them%20to%20make%20them%20align%20in%20the%20graphic%0A%20%20%20%20for%20_col%20in%20continuation.columns%5B1%3A5%5D%3A%0A%20%20%20%20%20%20%20%20continuation%5B_col%5D%20%3D%20continuation%5B_col%5D.apply(lambda%20x%3A%20x%20*%20scale.value)%0A%20%20%20%20return%20(continuation%2C)%0A%0A%0A%40app.cell%0Adef%20_(is_data_loaded%2C%20mo)%3A%0A%20%20%20%20mo.stop(not%20is_data_loaded())%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20The%20models'%20predictions%2C%20together%20with%20the%20data%20used%20for%20their%20training%2C%20can%0A%20%20%20%20of%20course%20be%20synthesized%20into%20one%20data%20frame%3A%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(continuation%2C%20date_limit%2C%20df%2C%20pd%2C%20prediction)%3A%0A%20%20%20%20df_dummy%20%3D%20df%5Bdf.date%20%3E%3D%20pd.to_datetime(date_limit.value)%5D.drop(%0A%20%20%20%20%20%20%20%20%5B%22date%22%2C%20%22volume%22%2C%20%22adjclose_price%22%5D%2C%20axis%3D1%0A%20%20%20%20)%0A%20%20%20%20df_dummy.columns%20%3D%20df_dummy.columns.map(lambda%20name%3A%20f%22%7Bname%7D%20(original)%22)%0A%0A%20%20%20%20continuation_dummy%20%3D%20continuation.drop(%22volume%22%2C%20axis%3D1)%0A%20%20%20%20continuation_dummy.set_index(%22date%22%2C%20inplace%3DTrue%2C%20drop%3DTrue)%0A%20%20%20%20continuation_dummy.columns%20%3D%20continuation_dummy.columns.map(%0A%20%20%20%20%20%20%20%20lambda%20name%3A%20f%22%7Bname%7D%20(continued)%22%0A%20%20%20%20)%0A%0A%20%20%20%20prediction_dummy%20%3D%20pd.concat(%0A%20%20%20%20%20%20%20%20%5Bp.set_index(%22Date%22%2C%20drop%3DTrue)%20for%20col%2C%20p%20in%20prediction.items()%5D%2C%20axis%3D1%0A%20%20%20%20)%0A%20%20%20%20prediction_dummy.columns%20%3D%20prediction_dummy.columns.map(%0A%20%20%20%20%20%20%20%20lambda%20name%3A%20f%22%7Bname%7D%20(predicted)%22%0A%20%20%20%20)%0A%0A%20%20%20%20synthesized%20%3D%20df_dummy.join(continuation_dummy%2C%20how%3D%22outer%22).join(%0A%20%20%20%20%20%20%20%20prediction_dummy%2C%20how%3D%22outer%22%0A%20%20%20%20)%0A%20%20%20%20synthesized.reset_index(inplace%3DTrue)%0A%20%20%20%20synthesized.rename(columns%3D%7B%22index%22%3A%20%22date%22%7D%2C%20inplace%3DTrue)%0A%20%20%20%20synthesized%0A%20%20%20%20return%20(synthesized%2C)%0A%0A%0A%40app.cell%0Adef%20_(is_data_loaded%2C%20mo)%3A%0A%20%20%20%20mo.stop(not%20is_data_loaded())%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20Using%20the%20%22Download%22%20button%2C%20this%20could%20be%20exported%20into%20CSV%2C%20JSON%20or%0A%20%20%20%20Parquet%20format.%20%20And%20since%20it's%20a%20%60pandas%60%20data%20frame%2C%20Excel%2C%20SQL%2C%20and%20many%0A%20%20%20%20more%20formats%20would%20also%20be%20options%20in%20practice%2C%20allowing%20their%20use%20in%0A%20%20%20%20reports%2C%20presentations%20and%20other%20applications%20elsewhere.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(is_data_loaded%2C%20mo)%3A%0A%20%20%20%20mo.stop(not%20is_data_loaded())%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Exploration%20and%20Discussion%0A%0A%20%20%20%20As%20mentioned%20multiple%20times%20already%2C%20feel%20free%20to%20tweak%20the%20parameters%20and%0A%20%20%20%20ranges%2C%20and%20see%20how%20it%20affects%20the%20ARIMA%20models'%20predictions.%0A%0A%20%20%20%20You'll%20notice%20that%2C%20for%20this%20paritcular%20dataset%20and%20scenario%2C%20increasing%20the%0A%20%20%20%20autoregression%20order%20%24p%24%20makes%20the%20models%20much%20more%20sensible%20for%20small%20local%0A%20%20%20%20fluctuations%2C%20as%20well%20as%20making%20them%20overly%20optimistic%20as%20they%20predict%0A%20%20%20%20further%20into%20the%20future.%20%20That's%20due%20to%20giving%20the%20most%20recent%20developments%0A%20%20%20%20a%20much%20stronger%20influence%20on%20the%20prediction%2C%20encouraging%20the%20assumption%20that%0A%20%20%20%20the%20*irregularity*%20at%20the%20end%20would%20continue%20(including%20its%20accelerating%0A%20%20%20%20trend).%0A%0A%20%20%20%20The%20moving%20average%20order%20%24d%24%20does%20something%20similar%20because%20the%20price%0A%20%20%20%20average%20*does*%20increase%20within%20the%20observed%20time%20window.%20%20Note%20that%20setting%0A%20%20%20%20it%20to%20%240%24%20removes%20stability%20and%20slows%20the%20relaxation%20of%20seemingly%20chaotic%0A%20%20%20%20oscillations%20in%20future%20predictions%20(caused%20by%20%24p%24).%0A%0A%20%20%20%20%24d%24%2C%20then%2C%20acts%20as%20a%20counter%20balance%20to%20short-term%20fluctuations.%20%20In%20our%0A%20%20%20%20case%2C%20it%20dampens%20the%20models'%20optimism%20somewhat%2C%20allowing%20them%20to%20make%20more%0A%20%20%20%20or%20less%20reasonable%20predictions%20even%20throughout%20the%20strong%20irregularity%20in%0A%20%20%20%20the%20end.%20%20However%2C%20it's%20so%20strong%20that%20if%20not%20carefully%20chosen%20together%20with%0A%20%20%20%20%24p%24%20and%20%24q%24%2C%20the%20predictions%20are%20simply%20chaotic%20and%20meaningless.%20%20(Although%0A%20%20%20%20the%20same%20can%20be%20set%20to%20every%20*random*%20and%20*arbitrary*%20choice%20of%20parameters.)%0A%0A%20%20%20%20%23%23%20Thak%20you%20for%20taking%20a%20look%20at%20that%20little%20demo!%0A%0A%20%20%20%20I%20hope%20that%20although%20a%20bit%20technical%20in%20some%20places%2C%20this%20little%20demo%20was%0A%20%20%20%20insightful%20and%20entertaining%20to%20play%20around%20with.%20%20And%20if%20the%20technical%20stuff%0A%20%20%20%20is%20why%20you're%20here%20in%20the%20first%20place%2C%20note%20that%20you%20can%20toggle%20the%20source%0A%20%20%20%20code%20revelation%20through%20the%20buttin%20with%20the%20ellipsis%20in%20the%20top%20right%0A%20%20%20%20corner.%0A%20%20%20%20If%20you%20like%20it%2C%20feel%20free%20to%20visit%20me%20on%20my%20website%0A%20%20%20%20(%5Barcticneural.de%5D(https%3A%2F%2Farciticneural.de)).%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
  </body>
</html>
